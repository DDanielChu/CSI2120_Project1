// Project CSI2120 / CSI2520
// Winter 2026
// Robert Laganiere, uottawa.ca
//
// Completed Program class for Stable Matching

import java.util.ArrayList;

public class Program {

    // Attributes
    private String programID;
    private String name;
    private int quota;
    private int[] rol;
    private ArrayList<Resident> matchedResidents;

    // constructs a Program
    public Program(String id, String n, int q) {
        programID = id;
        name = n;
        quota = q;
        matchedResidents = new ArrayList<>();
    }

    // Getters
    public String getProgramID() {
        return programID;
    }

    public String getName() {
        return name;
    }

    public int getQuota() {
        return quota;
    }

    public int[] getROL() {
        return rol;
    }

    public ArrayList<Resident> getMatchedResidents() {
        return matchedResidents;
    }

    // Setters
    public void setName(String name) {
        this.name = name;
    }

    public void setQuota(int quota) {
        this.quota = quota;
    }

    // the rol in order of preference
    public void setROL(int[] rol) {
        this.rol = rol;
    }

    // return true if residentID is in program's ROL
    public boolean member(int residentID) {

        for (int i = 0; i < rol.length; i++) {
            if (rol[i] == residentID) {
                return true;
            }
        }

        return false;
    }

    // return rank of a resident in the ROL, else -1
    public int rank(int residentID) {

        for (int i = 0; i < rol.length; i++) {
            if (rol[i] == residentID) {
                return i;
            }
        }

        return -1;
    }

    // return least preferred currently matched resident
    public Resident leastPreferred() {

        Resident worst = null;
        int worstRank = -1;

        for (Resident r : matchedResidents) {
            int rRank = rank(r.getResidentID());
            if (rRank > worstRank) {
                worstRank = rRank;
                worst = r;
            }
        }

        return worst;
    }

    // adds a resident to this program
    public void addResident(Resident r) {

        int rRank = rank(r.getResidentID());

        if (rRank == -1) {
            return;
        }

        // program not full
        if (matchedResidents.size() < quota) {
            matchedResidents.add(r);
            r.setMatchedProgram(this);
            return;
        }

        // program full
        Resident worst = leastPreferred();
        int worstRank = rank(worst.getResidentID());

        if (rRank < worstRank) {
            matchedResidents.remove(worst);
            worst.setMatchedProgram(null);

            matchedResidents.add(r);
            r.setMatchedProgram(this);
        }
    }

    // returns number of remaining positions
    public int availablePositions() {
        return quota - matchedResidents.size();
    }

    // string representation
    public String toString() {
        return "[" + programID + "]: " + name + " {" + quota + "} (" + rol.length + ")";
    }
}
